#!/bin/bash
# nvs $PKG
# Example: nvs @myscope/mypackage
#
# Quickly show nodejs version requirements and peer dependences from $NPM_CONFIG_REGISTRY

set -e
PKG=${!#}
REGISTRY=${NPM_CONFIG_REGISTRY:-https://registry.npmjs.org}
SECTION=peerDependencies

while getopts "h?Ddr:" opt; do
  case "$opt" in
    h|\?)
      echo rtfs
      exit 1
      ;;
    D)  SECTION=devDependencies
      ;;
    d)  SECTION=dependencies
      ;;
    r)  REGISTRY=$OPTARG
      ;;
  esac
done

curl -s "${REGISTRY}/${PKG}" | \
  jq ".time as \$t | .versions|map([.version,\$t[.version], .engines.node,(.${SECTION}|tostring)]|@tsv)|join(\"\n\")" -r
